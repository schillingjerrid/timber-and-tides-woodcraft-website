---
import BaseLayout from "../../layouts/BaseLayout.astro";
import Gallery from "../../components/Gallery.astro";
import TagPill from "../../components/TagPill.astro";
import { getCollection, getEntryBySlug } from "astro:content";

export async function getStaticPaths() {
  const projects = await getCollection("projects");
  return projects.map((p) => ({ params: { slug: p.slug } }));
}

const { slug } = Astro.params;
const project = await getEntryBySlug("projects", slug!);
if (!project) throw new Error(`Project not found: ${slug}`);

const { Content } = await project.render();
const d = project.data;
---

<BaseLayout title={`${d.title} — Projects`} description={d.excerpt ?? "Woodworking project details."}>
  <article class="py-8">
    <a href="/projects/" class="text-sm text-zinc-300 hover:text-white">← Back to projects</a>

    <h1 class="mt-3 text-3xl sm:text-4xl font-bold tracking-tight">{d.title}</h1>

    <div class="mt-3 flex flex-wrap gap-2 text-sm text-zinc-300">
      <span>{d.date.toLocaleDateString()}</span>
      {d.wood && <span>• Wood: {d.wood}</span>}
      {d.finish && <span>• Finish: {d.finish}</span>}
      {d.dimensions && <span>• Size: {d.dimensions}</span>}
    </div>

    {d.tags?.length > 0 && (
      <div class="mt-4 flex flex-wrap gap-2">
        {d.tags.map((t) => <TagPill tag={t} />)}
      </div>
    )}

    <div class="mt-6 overflow-hidden rounded-2xl border border-zinc-800 bg-zinc-900">
      <img src={d.coverImage} alt={d.title} class="h-full w-full object-cover" />
    </div>

    <div class="prose prose-invert mt-8 max-w-none prose-headings:tracking-tight prose-a:text-white">
      <Content />
    </div>

    <Gallery images={d.gallery} altPrefix={d.title} />
  </article>
</BaseLayout>
